<!DOCTYPE html>
<html>

<head>
	<link rel="icon" type="image/png" href="icons8-harambe-the-gorilla-50.png" />
	<script src="babel.min.js"></script>
	<script src="react.development.js"></script>
	<script src="react-dom.development.js"></script>
	<script src="react-router-dom.js"></script>
	<script nomodule src="bundle.es5.js"></script>
	<script src="bundle.esm.js" type="module"></script>
</head>

<body id="content" class="sapUiBody">
	<div id="react-root"></div>

	<script type="text/babel">
		// TODO
		// - create new game
		// - join game
		// - + QR code
		// - # integrate with server using web sockets
		// - + try different / more fancy UI library more suited for games
		// - respond to click -> evaluate
		// - podium screen
		// - try if using <> works, or why it doesn't work
		// DONE
		// - # entrance screen (enter name and game id)

		'use strict'

		function Podium() {
			return <div>
			</div>
		}

		function Question(props) {
			return <div style={{ display: "flex", flexDirection: "column" }}>
				<ui5-label>{props.text}</ui5-label>
				<img width="80%" src={props.imageUrl} />
			</div>
		}

		function AnswerBlock(props) {
			return <div style={{ display: "flex", flexDirection: "column" }}>
				<div style={{ display: "flex", flexDirection: "row" }}>
					<Answer text={props.answer1} />
					<Answer text={props.answer2} />
				</div>
				<div style={{ display: "flex", flexDirection: "row" }}>
					<Answer text={props.answer3} />
					<Answer text={props.answer4} />
				</div>
			</div>
		}

		function Entrance(props) {
			// TODO enable join button only when correct game id (e.g. exactly 6 numbers)
			const [gameId, setGameId] = React.useState('')
			const updateGameId = (event) => setGameId(event.target.value)

			return <div style={{ display: "flex", flexDirection: "column" }}>
				<ui5-label for="gameId" required>Game id</ui5-label>
				<ui5-input id="gameId" placeholder="Enter game id" value={gameId} onInput={updateGameId}></ui5-input>
				<ui5-label for="name" required>Name</ui5-label>
				<ui5-input id="name" placeholder="Enter your name" required></ui5-input>
				<ui5-button onClick={() => props.onJoin(gameId)}>Join game</ui5-button>
				<ui5-button onClick={() => props.onCreate()}>Create game</ui5-button>
			</div>
		}

		function Answer(props) {
			return <ui5-button design="Default" onClick={props.onClick}>{props.text}</ui5-button>
		}

		function Countdown() {
			let [isClockShown, setIsClockShown] = React.useState(true)
			const toggleClock = () => setIsClockShown(!isClockShown)
			return <div>
				<MyInput />
				<Welcome name={name} />
				{isClockShown ? <Clock /> : ''}
				<button onClick={toggleClock}>{isClockShown ? 'Hide Clock' : 'Show Clock'}</button>
			</div>
		}

		function PlayGame() {
			const { id } = ReactRouterDOM.useParams()
			let [isClockShown, setIsClockShown] = React.useState(true)
			const toggleClock = () => setIsClockShown(!isClockShown)
			return <div>
				<ui5-title level="H1">Game {id}</ui5-title>
				<Question text="Test question" imageUrl="" />
				<AnswerBlock answer1="sample answer 1" answer2="sample answer 2" answer3="sample answer 3" answer4="sample answer 4" />
			</div>
		}

		function HostGame() {
			return <div>
				todo
			</div>
		}

		function App() {
			let nextGameId = 100000
			const { HashRouter, Switch, Route } = ReactRouterDOM

			const audio = React.useRef(null)
			const [muted, setMuted] = React.useState(true)
			const toggleMute = () => setMuted(!muted)

			React.useEffect(() => audio.current.play(), [])

			const join = (gameId) => {
				window.location = `#/play/${gameId}`
			}
			const create = () => {
				window.location = `#/host/${nextGameId++}`
			}

			return <HashRouter>
				<audio id="audio" ref={audio} loop muted={muted} src="positive-funny-background-music-for-video-games.mp3"></audio>
				<ui5-button onClick={toggleMute} icon={muted ? 'sound' : 'sound-off'} aria-labelledby="mute"></ui5-button>
				<ui5-label style={{ display: "none" }} id="mute" aria-hidden="true">{muted ? 'Unmute' : 'Mute'} Sound</ui5-label>

				<Switch>
					<Route exact path="/">
						<Entrance onJoin={join} onCreate={create} />
					</Route>
					<Route path="/play/:id">
						<PlayGame />
					</Route>
					<Route path="/host/:id">
						<HostGame />
					</Route>
				</Switch>
				<ui5-label>
					<ui5-link target="_blank" href="https://icons8.com/icon/58842/harambe-the-gorilla">Harambe the Gorilla</ui5-link> favicon by <ui5-link target="_blank" href="https://icons8.com">Icons8</ui5-link>
				</ui5-label>
			</HashRouter>
		}

		const domContainer = document.querySelector('#react-root')
		ReactDOM.render(<App />, domContainer)

		// TODO make it a countdown
		function Clock() {
			const [date, setDate] = React.useState(new Date())

			React.useEffect(() => {
				const interval = setInterval(() => setDate(new Date()), 1000)
				return () => clearInterval(interval)
			}, [])

			return <div>
				<h2>It is {date.toLocaleTimeString()}</h2>
			</div>
		}
	</script>

</body>

</html>
