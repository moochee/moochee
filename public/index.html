<!DOCTYPE html>
<html>

<head>
	<link rel="icon" type="image/png" href="icons8-harambe-the-gorilla-50.png" />
	<script src="lib/babel.min.js"></script>
	<script src="lib/react.development.js"></script>
	<script src="lib/react-dom.development.js"></script>
	<script src="lib/react-router-dom.js"></script>
	<script nomodule src="lib/bundle.es5.js"></script>
	<script src="lib/bundle.esm.js" type="module"></script>
	<script src="components.js" type="text/babel"></script>
</head>

<body id="content" class="sapUiBody">
	<div id="react-root"></div>

	<script type="text/babel">
		// TODO
		// - don't only deliver the question - also deliver the 4 possible answers!
		// - guess the answer
		// - evaluate
		// - present next question
		// - + QR code
		// - + try different / more fancy UI library more suited for games
		// - # integrate with server using web sockets
		// - try implement both a WebSocket adapter and an HttpRestAdapter, both should work to be "plugged in" without changing the code
		// - respond to click -> evaluate
		// - podium screen
		// - try if using <> works, or understand why it doesn't work
		// - should participants see the other players?
		//
		// DONE
		// - # entrance screen (enter name and game id)
		// - create/host game
		// - join game
		// - copy url
		// - start the quiz after sufficient people joined

		'use strict'

		function WebSocketsAdapter() {
			let nextGameId = 100000
			const joinSubscribers = []

			this.subscribeJoin = (subscriber) => {
				joinSubscribers.push(subscriber)
			}

			this.unsubscribeJoin = (subscriber) => {
				const index = joinSubscribers.findIndex((js) => js === subscriber)
				joinSubscribers.splice(index, 1)
			}

			this.join = (gameId, playerName) => {
				joinSubscribers.forEach((js) => js(gameId, playerName))
			}

			this.host = () => {
				// TODO should come from server
				return String(nextGameId++)
			}
		}

		function HostGameWeb(props) {
			const { gameId } = ReactRouterDOM.useParams()
			return <HostGame gameId={gameId} adapter={props.adapter} />
		}

		function PlayGameWeb(props) {
			const { gameId, playerName } = ReactRouterDOM.useParams()
			return <PlayGame gameId={gameId} playerName={playerName} adapter={props.adapter} />
		}

		function WebApp(props) {
			const { HashRouter, Switch, Route } = ReactRouterDOM

			const join = (gameId, playerName) => {
				window.location = `#/play/${gameId}/${playerName}`
			}

			const host = (gameId) => {
				window.location = `#/host/${gameId}`
			}

			return <div style={{ marginLeft: "20%", marginRight: "20%" }}>
				<HashRouter>
					<Music />
					<Switch>
						<Route exact path="/">
							<Entrance onJoin={join} onHost={host} adapter={props.adapter} />
						</Route>
						<Route path="/play/:gameId/:playerName">
							<PlayGameWeb adapter={props.adapter} />
						</Route>
						<Route path="/host/:gameId">
							<HostGameWeb adapter={props.adapter} />
						</Route>
					</Switch>
					<References />
				</HashRouter>
			</div>
		}

		ReactDOM.render(<WebApp adapter={new WebSocketsAdapter()} />, document.querySelector('#react-root'))
	</script>

</body>

</html>
