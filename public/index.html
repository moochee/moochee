<!DOCTYPE html>
<html>

<head>
	<title>Gorilla</title>
	<link rel="icon" type="image/png" href="icons8-harambe-the-gorilla-50.png" />
	<link rel="stylesheet" type="text/css" href="font/komikatext_regular_macroman/stylesheet.css" />
	<link rel="stylesheet" type="text/css" href="components/sticky/sticky-button.css" />
	<script src="lib/babel.min.js"></script>
	<script src="lib/react.development.js"></script>
	<script src="lib/react-dom.development.js"></script>
	<script src="lib/react-router-dom.js"></script>
	<script nomodule src="lib/bundle.es5.js"></script>
	<script src="lib/bundle.esm.js" type="module"></script>
	<script src="components/general.js" type="text/babel"></script>
	<script src="components/entrance.js" type="text/babel"></script>
	<script src="components/host.js" type="text/babel"></script>
	<script src="components/play.js" type="text/babel"></script>
	<script src="components/podium/podium.js" type="text/babel"></script>
	<script src="components/sticky/sticky-button.js" type="text/babel"></script>
	<script src="/socket.io/socket.io.js"></script>
</head>

<body id="content" class="sapUiBody">
	<div id="react-root"></div>

	<script type="text/babel" data-type="module">
		'use strict'
		
		import WsClientAdapter from "./ws-client-adapter.js"

		function HostGameWeb(props) {
			const { gameId } = ReactRouterDOM.useParams()
			return <div>
				<Music />
				<HostGame gameId={gameId} adapter={props.adapter} />
			</div>
		}

		function PlayGameWeb(props) {
			const { gameId, playerName } = ReactRouterDOM.useParams()
			return <div>
				<PlayGame gameId={gameId} playerName={playerName} adapter={props.adapter} />
			</div>
		}

		function PlayerName(props) {
			const { gameId } = ReactRouterDOM.useParams()
			const [playerName, setPlayerName] = React.useState('')
    	const updatePlayerName = (event) => setPlayerName(event.target.value)

			const nameExistsToast = React.createRef()

			const join = async () => {
        // TODO do we get avatar back? and if yes, what to do with it?
        const joined = await props.adapter.join(gameId, playerName)
				if (joined) {
        	props.onJoin(gameId, playerName)
				} else {
					nameExistsToast.current.show()
				}
    	}
			
			return <div style={{ display: "flex", flexDirection: "column" }}>
				<ui5-title level="H1">Game {gameId}</ui5-title>
				<ui5-label for="playerName" required>Name</ui5-label>
				<ui5-input style={{ width: "100%" }} id="playerName" placeholder="Enter your name" value={playerName} onInput={updatePlayerName}></ui5-input>
				<ui5-button style={{ width: "100%" }} onClick={join}>Join</ui5-button>
				<ui5-toast ref={nameExistsToast}>Player {playerName} exists, choose another name!</ui5-toast>
			</div>
		}

		function WebApp(props) {
			const { HashRouter, Switch, Route } = ReactRouterDOM

			const join = (gameId, playerName) => {
				window.location = `#/play/${gameId}/${playerName}`
			}

			const host = (gameId) => {
				window.location = `#/host/${gameId}`
			}

			return <div style={{ marginLeft: "20%", marginRight: "20%" }}>
				<HashRouter>
					<Switch>
						<Route exact path="/">
							<Entrance onJoin={join} onHost={host} adapter={props.adapter} />
						</Route>
						<Route path="/play/:gameId/:playerName">
							<PlayGameWeb adapter={props.adapter} />
						</Route>
						<Route path="/play/:gameId">
							<PlayerName adapter={props.adapter} onJoin={join}/>
						</Route>
						<Route path="/host/:gameId">
							<HostGameWeb adapter={props.adapter} />
						</Route>
					</Switch>
				</HashRouter>
				<p />
				<References />
			</div>
		}

		ReactDOM.render(<WebApp adapter={new WsClientAdapter(io())} />, document.querySelector('#react-root'))
	</script>
</body>

</html>
